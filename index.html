<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <!-- <script src="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Cesium.js"></script> -->
  <script src="./node_modules/cesium/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>
<body>
  <div id="cesiumContainer"></div>
  <!-- <iframe src="index.html" id="cesiumContainer" frameborder="0" sandbox="allow-scripts"></iframe> -->
  <script type="module">
    // // Your access token can be found at: https://ion.cesium.com/tokens.
    // // This is the default access token from your ion account
    
    window.CESIUM_BASE_URL='./node_modules/cesium/Build/Cesium'
    
    // import { Cartesian3, createOsmBuildingsAsync, Ion, Math as CesiumMath, Terrain, Viewer } from 'cesium';
    // import "cesium/Build/Cesium/Widgets/widgets.css";

    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5MThkYmEwYS1jYWFiLTRiMDgtODhjYS0wMDI1MGI5NjhjYWMiLCJpZCI6MTUyNzUzLCJpYXQiOjE2ODg5NzIwNTJ9.y56dpnYgLwtT2_XX6IOccZYa0M1RA3Qvej2B-CmS1oE';

    // // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    // const viewer = new Cesium.Viewer('cesiumContainer', {
    //   terrain: Cesium.Terrain.fromWorldTerrain(),
    // });    

    // // Fly the camera to San Francisco at the given longitude, latitude, and height.
    // viewer.camera.flyTo({
    //   destination: Cesium.Cartesian3.fromDegrees(-122.4175, 37.655, 400),
    //   orientation: {
    //     heading: Cesium.Math.toRadians(0.0),
    //     pitch: Cesium.Math.toRadians(-15.0),
    //   }
    // });

    // // Add Cesium OSM Buildings, a global 3D buildings layer.
    // const buildingTileset = await Cesium.createOsmBuildingsAsync();
    // viewer.scene.primitives.add(buildingTileset);  
    
    const viewer = new Cesium.Viewer('cesiumContainer'); 

    const camera = new Cesium.Camera(viewer.scene);
    camera.position = new Cesium.Cartesian3();
    camera.direction = Cesium.Cartesian3.negate(Cesium.Cartesian3.UNIT_Z, new Cesium.Cartesian3());
    camera.up = Cesium.Cartesian3.clone(Cesium.Cartesian3.UNIT_Y);
    camera.frustum.fov = Cesium.Math.PI_OVER_THREE;
    camera.frustum.near = 1.0;
    camera.frustum.far = 2.0;

    console.log('retrieving from root');
    const tilesetUrl = '/given_data/root.json'; // Replace with the URL of your root JSON file
    // const dataFolderUrl = './given_data/v1_globe/3dtiles/datasets/CgA/files'; // Replace with the URL of your data folder

    // const tileset = viewer.scene.primitives.add(new Cesium.Cesium3DTileset({
    //         url: tilesetUrl,
    //     }));
    
    console.log('awaiting tileset');
    try {
      const tileset = await Cesium.Cesium3DTileset.fromUrl(
        tilesetUrl
      );
      console.log('went to root.json');
      
      viewer.scene.primitives.add(tileset);
      
      viewer.camera.flyToBoundingSphere(tileset.boundingSphere);
    } catch (error) {
      console.log(`Error loading tileset: ${error}`);
    }

    // Fly to the root tileset's bounding sphere once it is loaded
    // tileset.readyPromise.then(function (tileset) {
    //     viewer.camera.flyToBoundingSphere(tileset.boundingSphere, {
    //         duration: 2.0,
    //     });
    //   });
  
    // fetch(rootJsonUrl)
    //   .then(response => {
    //     console.log('Root JSON response: ', response);
    //     return response.json();
    //   })
    //   .then(tileset => {
    //     console.log('Tileset: ', tileset);
    //     const tilesetPromises = [];

    //     // Recursively process the tree of nodes in the tileset
    //     function processNode(node) {
    //       if (node.children) {
    //         // Process child nodes recursively
    //         node.children.forEach(child => processNode(child));
    //       }

    //       if (node.content && node.content.url) {
    //         // Create a promise to load the JSON or glTF file for each content
    //         const contentUrl = dataFolderUrl + node.content.url;

    //         if (contentUrl.toLowerCase().endsWith('.json')) {
    //           // Load JSON file
    //           const jsonPromise = fetch(contentUrl)
    //             .then(response => response.json())
    //             .then(json => {
    //               // Process the JSON data as needed
    //               console.log('Loaded JSON:', json);
    //             });

    //           tilesetPromises.push(jsonPromise);
    //         } else if (contentUrl.toLowerCase().endsWith('.glb')) {
    //           // Load glTF (glb) file
    //           const gltfPromise = Cesium.Model.fromGltf({
    //             url: contentUrl
    //           })
    //             .then(model => {
    //               viewer.scene.primitives.add(model);
    //               // Optional: Adjust settings or add event handlers to the model
    //             });

    //           tilesetPromises.push(gltfPromise);
    //         }
    //       }
    //     }

    //     // Start processing the root tile
    //     processNode(tileset.root);

    //     // Wait for all promises to resolve
    //     Promise.all(tilesetPromises)
    //       .then(() => {
    //         console.log('Tileset is ready');
    //       })
    //       .catch(error => {
    //         console.error('Failed to load the tileset:', error);
    //       });
    //   })
    //   .catch(error => {
    //     console.error('Failed to fetch the root JSON file:', error);
    //   });

  </script>
 </div>
</body>
</html>